<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Yoshi Egg Clicker</title>
  <style>
    :root{
      --bg1:#f8fff8;
      --bg2:#b6fcb6;
      --panel:#ffffffcc;
      --accent:#46c26b;
      --muted:#6b6b6b;
    }
    html,body{height:100%;margin:0;font-family:Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,Arial}
    body{
      background: linear-gradient(180deg,var(--bg1),var(--bg2));
      display:flex;align-items:center;justify-content:center;padding:20px;
    }

    .game {
      width:100%;max-width:960px;background:linear-gradient(180deg,rgba(255,255,255,0.9),rgba(255,255,255,0.8));
      border-radius:12px;box-shadow:0 12px 40px rgba(10,20,10,0.12);overflow:hidden;display:grid;grid-template-columns:1fr 360px;
    }

    .main{
      padding:28px;display:flex;flex-direction:column;align-items:center;justify-content:center;position:relative;
    }

    .stats{position:absolute;top:16px;left:16px;background:var(--panel);padding:8px 12px;border-radius:10px;box-shadow:0 6px 18px rgba(0,0,0,0.06);font-weight:600}

    .egg-area{display:flex;flex-direction:column;align-items:center;gap:12px}
    #eggButton{background:transparent;border:none;padding:0;cursor:pointer}
    #eggImage{height:160px;transition:transform .12s ease;will-change:transform}
    #eggImage.pulse{transform:scale(1.16)}

    .big-count{font-size:28px;font-weight:700;color:#145214}
    .sub{color:var(--muted);font-size:13px}

    .floating{position:absolute;pointer-events:none;font-weight:700;color:var(--accent);transform:translateY(-10px);opacity:0;transition:transform .6s ease,opacity .6s}

    .sidebar{padding:18px;background:linear-gradient(180deg,#fff,#f6fff6);border-left:1px solid rgba(0,0,0,0.02);min-height:420px}
    .panel{background:var(--panel);padding:12px;border-radius:10px;margin-bottom:12px;box-shadow:0 6px 18px rgba(0,0,0,0.04)}
    h3{margin:0 0 8px 0}

    .store-item{display:flex;justify-content:space-between;align-items:center;padding:8px;border-radius:8px;margin-bottom:8px;background:linear-gradient(90deg,#fff,#fbfffb)}
    .store-left{display:flex;gap:8px;align-items:center}
    .btn{background:var(--accent);color:#fff;padding:8px 10px;border-radius:8px;border:none;cursor:pointer;font-weight:700}
    .btn[disabled]{opacity:.5;cursor:not-allowed}

    .controls{display:flex;gap:8px;margin-top:8px}
    .small{font-size:12px;padding:6px 8px}

    .ach-list{display:flex;flex-direction:column;gap:6px}
    .ach{padding:8px;border-radius:8px;background:#fffefc;border:1px solid rgba(0,0,0,0.03);font-size:13px}

    footer{padding:12px;text-align:center;color:var(--muted);font-size:13px}

    @media(max-width:820px){.game{grid-template-columns:1fr}.sidebar{order:2}}
  </style>
</head>
<body>
  <div class="game" role="application" aria-label="Yoshi Egg Clicker">
    <div class="main">
      <div class="stats" id="stats">Eggs: 0 â€¢ CPS: 0</div>

      <div class="egg-area">
        <div class="big-count" id="bigCount">0</div>
        <div class="sub" id="perClick">Per Click: 1</div>

        <button id="eggButton" aria-label="Tap the Yoshi egg">
          <img id="eggImage" src="yoshi-egg.webp" alt="Yoshi egg" />
        </button>
        <div class="sub">Click the egg to collect eggs. Save is automatic.</div>
      </div>

      <div id="floatContainer"></div>
      <div style="position:absolute;bottom:14px;left:18px;display:flex;gap:8px;align-items:center">
        <button class="small btn" id="importBtn">Import</button>
        <button class="small" id="exportBtn">Export</button>
        <button class="small" id="resetBtn">Reset</button>
      </div>
    </div>

    <aside class="sidebar">
      <div class="panel">
        <h3>Upgrades</h3>
        <div id="store"></div>
      </div>

      <div class="panel">
        <h3>Upgrades owned</h3>
        <div id="owned"></div>
      </div>

      <div class="panel">
        <h3>Achievements</h3>
        <div class="ach-list" id="achievements"></div>
      </div>

      <div class="panel">
        <h3>Save</h3>
        <div class="sub">Auto-saves every 5s. You can export/import JSON for backups.</div>
      </div>
    </aside>
  </div>

  <script>
  (() => {
    const STORAGE_KEY = 'yoshiEggClicker_v2';

    const defaultState = {
      eggs: 0,
      perClick: 1,
      cps: 0,
      lastTick: Date.now(),
      upgrades: {},
      achievements: {},
      totalEggs: 0,
      prestigeStars: 0,
      hatched: false
    };

    // Base store items (more tiers added)
    const STORE = [
      { id: 'cursor', name: 'Tiny Helper', baseCost: 15, cps: 0.1, perClick:0, desc: 'A tiny friend that collects eggs slowly.' },
      { id: 'feather', name: 'Lucky Feather', baseCost: 80, cps:0, perClick:1, desc: 'Increases eggs per click.' },
      { id: 'fence', name: 'Fence of Comfort', baseCost: 100, cps: 1, perClick:0, desc: 'Makes your egg feel safe and productive.' },
      { id: 'nursery', name: 'Nursery', baseCost: 500, cps: 5, perClick:0, desc: 'A proper place to incubate more eggs.' },
      { id: 'farm', name: 'Egg Farm', baseCost: 2200, cps: 25, perClick:0, desc: 'A farm producing many eggs.' },
      { id: 'factory', name: 'Incubator Factory', baseCost: 15000, cps: 200, perClick:0, desc: 'Industrial incubation.' },
      { id: 'lab', name: 'Yoshi Lab', baseCost: 90000, cps: 1200, perClick:0, desc: 'High-tech incubation boosts.' },
      { id: 'multiplier', name: 'Yoshi Cheer', baseCost: 1200, cps:0, perClick:0, multiplier:1.15, desc: 'Each purchase increases all yields.' }
    ];

    // Achievements
    const ACHS = [
      { id:'click10', title:'Starter Peck', condition: s => s.totalEggs >= 10 },
      { id:'click100', title:'Egg Enthusiast', condition: s => s.totalEggs >= 100 },
      { id:'click1000', title:'Egg Hoarder', condition: s => s.totalEggs >= 1000 },
      { id:'own1', title:'First Helper', condition:s => (s.upgrades.cursor||0) >= 1 },
      { id:'powered', title:'Powered Up', condition:s => s.cps >= 100 }
    ];

    // Helpers
    function format(n){ if(n>=1e9) return (n/1e9).toFixed(2)+'B'; if(n>=1e6) return (n/1e6).toFixed(2)+'M'; if(n>=1000) return (n/1000).toFixed(1)+'k'; return Math.floor(n); }

    // Load or init
    let state;
    try{ state = JSON.parse(localStorage.getItem(STORAGE_KEY)) || defaultState; }
    catch(e){ state = defaultState; }
    state.upgrades = state.upgrades || {};
    state.achievements = state.achievements || {};
    state.totalEggs = state.totalEggs || 0;
    state.prestigeStars = state.prestigeStars || 0;
    state.hatched = state.hatched || false;

    // UI refs
    const bigCount = document.getElementById('bigCount');
    const perClickEl = document.getElementById('perClick');
    const stats = document.getElementById('stats');
    const storeEl = document.getElementById('store');
    const ownedEl = document.getElementById('owned');
    const achievementsEl = document.getElementById('achievements');
    const eggBtn = document.getElementById('eggButton');
    const eggImg = document.getElementById('eggImage');
    const floatContainer = document.getElementById('floatContainer');
    const resetBtn = document.getElementById('resetBtn');
    const exportBtn = document.getElementById('exportBtn');
    const importBtn = document.getElementById('importBtn');

    // Audio: tiny WAV generator -> base64 URI
    function makeToneBase64(freq = 440, duration = 0.08, volume = 0.6, sampleRate = 22050){
      const length = Math.floor(sampleRate * duration);
      const buffer = new ArrayBuffer(44 + length * 2);
      const view = new DataView(buffer);
      function writeString(view, offset, string){ for(let i=0;i<string.length;i++) view.setUint8(offset+i,string.charCodeAt(i)); }
      writeString(view,0,'RIFF');
      view.setUint32(4,36 + length*2,true);
      writeString(view,8,'WAVE');
      writeString(view,12,'fmt ');
      view.setUint32(16,16,true);
      view.setUint16(20,1,true);
      view.setUint16(22,1,true);
      view.setUint32(24,sampleRate,true);
      view.setUint32(28,sampleRate*2,true);
      view.setUint16(32,2,true);
      view.setUint16(34,16,true);
      writeString(view,36,'data');
      view.setUint32(40,length*2,true);
      for(let i=0;i<length;i++){
        const t = i / sampleRate;
        const s = Math.sin(2*Math.PI*freq*t) * volume * (1 - t/duration);
        const val = Math.max(-1,Math.min(1,s));
        view.setInt16(44 + i*2, val * 0x7fff, true);
      }
      let binary = '';
      const bytes = new Uint8Array(buffer);
      const chunk = 0x8000;
      for (let i = 0; i < bytes.length; i += chunk) {
        binary += String.fromCharCode.apply(null, bytes.subarray(i, i + chunk));
      }
      return 'data:audio/wav;base64,' + btoa(binary);
    }

    const clickSound = new Audio(makeToneBase64(880, 0.06, 0.35));
    const buySound = new Audio(makeToneBase64(560, 0.12, 0.35));
    const hatchSound = new Audio(makeToneBase64(420, 0.28, 0.48));

    // Compute derived values
    function computeCPS(s){
      let cps = 0;
      for(const item of STORE){
        const cnt = s.upgrades[item.id]||0;
        if(item.cps) cps += item.cps * cnt;
      }
      let mult = 1 + (s.prestigeStars || 0) * 0.05; // prestiges give 5% per star
      const mulCnt = s.upgrades.multiplier||0;
      if(mulCnt) mult *= Math.pow(1.15, mulCnt);
      return cps * mult;
    }

    function computePerClick(s){
      let pc = s.perClick || 1;
      for(const item of STORE){
        const cnt = s.upgrades[item.id]||0;
        if(item.perClick) pc += item.perClick * cnt;
      }
      const mulCnt = s.upgrades.multiplier||0;
      if(mulCnt) pc *= Math.pow(1.15, mulCnt);
      pc *= (1 + (s.prestigeStars || 0) * 0.03); // prestige adds 3% per star to clicks
      return pc;
    }

    function priceFor(item, owned){
      return Math.ceil(item.baseCost * Math.pow(1.15, owned));
    }

    // Add colored eggs to STORE (they appear when unlocked)
    function extendStoreWithColored(){
      const colored = [
        { id:'blue_egg', name:'Blue Egg', baseCost: 500, cps:0, perClick:2, desc:'A cool blue egg that gives click power.' },
        { id:'red_egg', name:'Red Egg', baseCost: 1200, cps:0, perClick:4, desc:'A brave red egg boosting clicks.' },
        { id:'purple_egg', name:'Purple Egg', baseCost: 2800, cps:0, perClick:8, desc:'A rare purple egg.' },
        { id:'gold_egg', name:'Gold Egg', baseCost: 8000, cps:0, perClick:20, desc:'A glorious gold egg.' }
      ];
      for(const c of colored){ if(!STORE.find(s=>s.id===c.id)) STORE.push(c); }
    }

    extendStoreWithColored();

    // UI render
    function render(){
      state.cps = computeCPS(state);
      const pc = computePerClick(state);
      bigCount.textContent = format(state.eggs);
      perClickEl.textContent = 'Per Click: ' + (pc%1?pc.toFixed(2):pc);
      stats.textContent = `Eggs: ${format(state.eggs)} â€¢ CPS: ${state.cps.toFixed(2)} â€¢ Stars: ${state.prestigeStars}`;

      // Store
      storeEl.innerHTML = '';
      for(const item of STORE){
        // colored eggs locked until lifetime milestones
        if(item.id.endsWith('_egg')){
          const req = { blue_egg:500, red_egg:1000, purple_egg:2000, gold_egg:3500 }[item.id] || 0;
          if((state.totalEggs||0) < req) continue;
        }
        const owned = state.upgrades[item.id]||0;
        const cost = priceFor(item, owned);
        const div = document.createElement('div'); div.className='store-item';
        div.innerHTML = `<div class="store-left"><div><strong>${item.name}</strong><div class="sub">${item.desc}</div></div></div>`;
        const right = document.createElement('div');
        const info = document.createElement('div'); info.style.textAlign='right'; info.style.marginRight='8px';
        info.innerHTML = `<div style="font-weight:700">${owned} owned</div><div class="sub">Cost: ${cost}</div>`;
        const btn = document.createElement('button'); btn.className='btn small'; btn.textContent='Buy';
        if(state.eggs < cost) btn.disabled = true;
        btn.addEventListener('click', ()=>{ buy(item.id); });
        right.appendChild(info);
        right.appendChild(btn);
        div.appendChild(right);
        storeEl.appendChild(div);
      }

      // Owned list
      ownedEl.innerHTML = '';
      for(const item of STORE){
        const owned = state.upgrades[item.id]||0;
        if(owned>0){
          const el = document.createElement('div'); el.className='sub'; el.textContent = `${item.name}: ${owned}`;
          ownedEl.appendChild(el);
        }
      }

      // Achievements
      achievementsEl.innerHTML='';
      for(const a of ACHS){
        const got = state.achievements[a.id];
        const el = document.createElement('div'); el.className='ach';
        el.style.opacity = got? '1' : '0.6';
        el.textContent = a.title + (got? ' âœ…' : '');
        achievementsEl.appendChild(el);
      }
    }

    // Buy logic
    function buy(id){
      const item = STORE.find(i=>i.id===id);
      if(!item) return;
      const owned = state.upgrades[id]||0;
      const cost = priceFor(item, owned);
      if(state.eggs < cost) return;
      state.eggs -= cost;
      state.upgrades[id] = owned + 1;
      if(item.perClick) state.perClick = (state.perClick||1) + item.perClick;
      showFloat(`-${cost}`);
      try{ buySound.currentTime = 0; buySound.play().catch(()=>{}); }catch(e){}
      applyEggTint();
      render();
      save();
    }

    // Floating text
    function showFloat(text){
      const el = document.createElement('div'); el.className='floating'; el.textContent = text;
      floatContainer.appendChild(el);
      el.style.left = (Math.random()*140+200) + 'px';
      el.style.top = (Math.random()*40 + 180) + 'px';
      requestAnimationFrame(()=>{ el.style.opacity=1; el.style.transform='translateY(-60px)'; });
      setTimeout(()=>{ el.style.opacity=0; el.style.transform='translateY(-100px)'; }, 700);
      setTimeout(()=>el.remove(), 1400);
    }

    // Click handler
    eggBtn.addEventListener('click', ()=>{
      const pc = computePerClick(state);
      state.eggs += pc;
      state.totalEggs = (state.totalEggs||0) + pc;
      try{ clickSound.currentTime = 0; clickSound.play().catch(()=>{}); }catch(e){}
      eggImg.classList.add('pulse');
      setTimeout(()=>eggImg.classList.remove('pulse'),140);
      showFloat('+' + (pc%1?pc.toFixed(2):pc));
      // auto-hatch when reaching threshold
      if(!state.hatched && (state.totalEggs || 0) >= 5000){ doHatch(); }
      render();
      save();
      checkAchievements();
    });

    // Ticking for CPS
    function tick(){
      const now = Date.now();
      const elapsed = Math.max(0, now - (state.lastTick || now));
      const delta = elapsed/1000;
      const cps = computeCPS(state);
      state.eggs += cps * delta;
      state.totalEggs = (state.totalEggs||0) + cps * delta;
      state.lastTick = now;
      render();
      checkAchievements();
    }

    // Achievements
    function checkAchievements(){
      for(const a of ACHS){
        if(!state.achievements[a.id] && a.condition(state)){
          state.achievements[a.id] = true;
          showFloat('Achievement!');
        }
      }
    }

    // Egg tint based on colored eggs owned
    function applyEggTint(){
      const order = ['gold_egg','purple_egg','red_egg','blue_egg'];
      const filters = {
        blue_egg: 'hue-rotate(200deg) saturate(1.2)',
        red_egg: 'hue-rotate(320deg) saturate(1.3)',
        purple_egg: 'hue-rotate(260deg) saturate(1.4)',
        gold_egg: 'sepia(0.3) hue-rotate(30deg) saturate(1.6)'
      };
      for(const id of order){ if((state.upgrades[id]||0) > 0){ eggImg.style.filter = filters[id]; return; } }
      eggImg.style.filter = '';
    }

    // Hatch animation and effect
    function doHatch(){
      state.hatched = true;
      try{ hatchSound.currentTime = 0; hatchSound.play().catch(()=>{}); }catch(e){}
      showFloat('HATCHED!');
      state.perClick = (state.perClick||1) + 5;
      eggImg.style.transition = 'transform .8s ease, box-shadow .6s ease';
      eggImg.style.transform = 'rotate(-12deg) scale(1.08)';
      setTimeout(()=>{ eggImg.style.transform = ''; eggImg.style.boxShadow = '0 8px 30px rgba(255,200,40,0.25)'; },900);
      save(); render();
    }

    // Save/load
    function save(){ try{ localStorage.setItem(STORAGE_KEY, JSON.stringify(state)); } catch(e){} }

    function reset(){ if(!confirm('Reset all progress?')) return; state = JSON.parse(JSON.stringify(defaultState)); save(); render(); }

    // Export/import
    exportBtn.addEventListener('click', ()=>{
      const data = JSON.stringify(state, null, 2);
      const blob = new Blob([data], {type:'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href=url; a.download='yoshi-egg-save.json'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
    });

    importBtn.addEventListener('click', ()=>{
      const input = document.createElement('input'); input.type='file'; input.accept='application/json';
      input.onchange = e => { const f = e.target.files[0]; if(!f) return; const r = new FileReader(); r.onload = ev => { try{ const obj = JSON.parse(ev.target.result); state = obj; state.upgrades = state.upgrades||{}; state.achievements = state.achievements||{}; save(); render(); } catch(e){ alert('Invalid file'); } }; r.readAsText(f); };
      input.click();
    });

    resetBtn.addEventListener('click', reset);

    // Prestige / Rebirth
    function prestige(){
      const threshold = 100000;
      if(state.eggs < threshold){ alert('Need ' + threshold + ' eggs in bank to prestige.'); return; }
      const gained = Math.floor(state.eggs / threshold);
      if(!confirm('Prestige will reset progress but grant ' + gained + ' Yoshi Stars. Continue?')) return;
      state = JSON.parse(JSON.stringify(defaultState));
      state.prestigeStars = (state.prestigeStars||0) + gained;
      save(); render(); alert('Gained ' + gained + ' Yoshi Stars!');
    }

    // Create prestige button
    const prestigeBtn = document.createElement('button'); prestigeBtn.className='small btn'; prestigeBtn.textContent='Prestige';
    prestigeBtn.addEventListener('click', prestige);
    document.querySelector('.main').appendChild(prestigeBtn);

    // Expose API for tests
    window.YoshiEggClicker = {
      getState(){ return JSON.parse(JSON.stringify(state)); },
      click(){ eggBtn.click(); },
      buy(id){ buy(id); },
      prestige(){ prestige(); },
      reset(){ reset(); },
      save(){ save(); }
    };

    // Periodic tasks
    setInterval(()=>{ save(); }, 5000);
    setInterval(tick, 200);
    setInterval(()=>{ applyEggTint(); }, 2000);

    // initial render
    applyEggTint();
    render();
    checkAchievements();
  })();
  </script>
</body>
</html>